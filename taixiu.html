<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>T√†i X·ªâu</title>
  <style>
    :root{--bg:#0f1724;--card:#111827;--accent:#06b6d4;--accent-2:#7c3aed;--muted:#94a3b8;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    body{margin:0;background:linear-gradient(180deg,#071029 0%, #07141c 50%);color:#e6eef6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:980px;max-width:100%;display:grid;grid-template-columns:1fr 420px;gap:20px}
    .panel{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 30px rgba(2,6,23,0.6);}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:20px;margin:0}
    .balance{font-weight:700;color:var(--accent)}

    .game-area{display:flex;flex-direction:column;gap:14px}
    .dice-row{display:flex;gap:14px;align-items:center;justify-content:center;padding:18px;background:var(--glass);border-radius:10px}
    .die{width:96px;height:96px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:56px;background:linear-gradient(180deg,#0b1220,#081018);box-shadow:inset 0 -6px 18px rgba(0,0,0,0.4);transition:transform 400ms ease}
    .die.shake{animation:shake 800ms ease-in-out}
    @keyframes shake{10%{transform:translateY(-8px)}30%{transform:translateY(6px)}50%{transform:translateY(-4px)}70%{transform:translateY(2px)}100%{transform:translateY(0)}}

    .controls{display:flex;gap:12px;align-items:center}
    .bet-box{display:flex;flex-direction:column;gap:8px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:10px}
    label{font-size:13px;color:var(--muted)}
    input[type=number]{width:150px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .choice{display:flex;gap:8px}
    .choice button{padding:10px 18px;border-radius:8px;border:none;background:#0b1220;color:#cfeff6;cursor:pointer}
    .choice button.active{background:var(--accent);color:#042023}
    .roll-btn{margin-left:auto;padding:12px 18px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#021017;font-weight:700;cursor:pointer}
    .roll-btn:disabled{opacity:0.5;cursor:not-allowed}

    .status{padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:14px}
    .result{display:flex;align-items:center;gap:12px}
    .chip{background:#022c2f;padding:6px 10px;border-radius:999px;color:#9ff0f6;font-weight:700}

    .jackpot{display:flex;align-items:center;gap:12px;background:linear-gradient(90deg,#2b0b2e,#3b0f3f);padding:10px;border-radius:10px}
    .jackpot .amount{font-weight:900;font-size:18px;color:#ffd166}

    .info{display:flex;flex-direction:column;gap:12px}
    .history{max-height:300px;overflow:auto;padding:8px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.008))}
    .h-item{display:flex;justify-content:space-between;padding:8px;border-bottom:1px solid rgba(255,255,255,0.02);font-size:13px}
    footer{font-size:12px;color:var(--muted);text-align:center;margin-top:10px}

    .confetti{position:absolute;pointer-events:none;}
    @media(max-width:900px){.app{grid-template-columns:1fr;}}
    
    .back-btn {
    position: absolute;
    top: 20px;
    left: 20px;
    background: linear-gradient(90deg, #06b6d4, #7c3aed);
    border: none;
    color: white;
    padding: 10px 18px;
    font-size: 15px;
    font-weight: 600;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.back-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(0,0,0,0.5);
}

  </style>
</head>

</script>
<body>
  <button id="backHome" class="back-btn">üè† Quay l·∫°i Trang Ch√≠nh</button>
  <div class="app">
    <div class="panel" style="position:relative">
      <header>
        <h1>T√†i X·ªâu </h1>
        <div>BALANCE: <span class="balance" id="balance">1000</span> ‚Ç´</div>
      </header>

      <div class="game-area">
        <div class="jackpot">
          <div style="font-size:13px;color:#ffd7a6">N·ªï h≈© (Jackpot)</div>
          <div class="amount" id="jackpotAmount">0 ‚Ç´</div>
          <div style="margin-left:auto;color:var(--muted);font-size:13px">M·ª©c ƒë√≥ng g√≥p: <strong id="contribPct">2%</strong> m·ªói v√°n</div>
        </div>

        <div class="dice-row" aria-live="polite">
          <div class="die" id="die1">‚öÄ</div>
          <div class="die" id="die2">‚öÄ</div>
          <div class="die" id="die3">‚öÄ</div>
        </div>

        <div class="controls">
          <div class="bet-box">
            <label>S·ªë ti·ªÅn c∆∞·ª£c</label>
            <input type="number" id="betAmount" min="1" value="50" />
          </div>

          <div class="bet-box">
            <label>Ch·ªçn c·ª≠a</label>
            <div class="choice">
              <button id="btnTai" class="active">T√†i (11 - 17)</button>
              <button id="btnXiu">X·ªâu (4 - 10)</button>
            </div>
          </div>

          <button id="roll" class="roll-btn">L·∫Øc X√≠ Ng·∫ßu</button>
        </div>

        <div class="status" id="status">Lu·∫≠t: T√†i 11‚Äì17, X·ªâu 4‚Äì10. N·∫øu ra Tam Hoa (3 m·∫∑t gi·ªëng nhau) th√¨ nh√† c√°i th·∫Øng ‚Äî tr·ª´ tr∆∞·ªùng h·ª£p <strong>3 x 6</strong> (6-6-6) s·∫Ω k√≠ch ho·∫°t <em>N·ªï H≈©</em> tr·∫£ th∆∞·ªüng jackpot cho ng∆∞·ªùi ch∆°i. M·ªói v√°n ƒë√≥ng g√≥p m·ªôt ph·∫ßn v√†o qu·ªπ jackpot.</div>

        <div class="result" id="resultArea" style="display:none">
          <div>K·∫øt qu·∫£: <span id="sum" style="font-weight:800;margin-left:6px">0</span></div>
          <div class="chip" id="payout">0</div>
          <div id="message" style="margin-left:auto"></div>
        </div>
      </div>

    </div>

    <aside class="panel info">
      <div>
        <h3 style="margin:0 0 8px 0">L·ªãch s·ª≠ v√°n</h3>
        <div class="history" id="history"></div>
      </div>

      <div>
        <h3 style="margin:0 0 8px 0">Th·ªëng tin</h3>
        <ul style="margin:0;padding-left:18px;color:var(--muted);font-size:13px">
          <li>T·ª∑ l·ªá T√†i/X·ªâu: 1 ƒÉn 1</li>
          <li>Tam Hoa 1‚Äì5: nh√† c√°i th·∫Øng (T√†i/X·ªâu thua)</li>
          <li>Tam Hoa 6 (6-6-6): k√≠ch ho·∫°t N·ªï H≈© ‚Äî ng∆∞·ªùi ch∆°i th·∫Øng JACKPOT</li>
          <li>ƒê√≥ng g√≥p v√†o jackpot: <span id="contribShow">2%</span> c·ªßa m·ªói v√°n (t·ªëi thi·ªÉu 1 ‚Ç´)</li>
        </ul>
      </div>

      <footer>For fun <strong>index.html</strong> </footer>
    </aside>
  </div>

  <canvas id="confetti" class="confetti" width="800" height="400" style="display:none"></canvas>

  <script>
    // --- Config ---
    const CONTRIB_PCT = 0.2; // 2% t·ª´ m·ªói v√°n s·∫Ω v√†o jackpot (l∆∞u √Ω: demo)
    const JACKPOT_BASE = 100000; // s·ªë kh·ªüi t·∫°o khi reset
    const diceChars = ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];

    // --- Elements ---
    const dieEls = [document.getElementById('die1'), document.getElementById('die2'), document.getElementById('die3')];
    const btnTai = document.getElementById('btnTai');
    const btnXiu = document.getElementById('btnXiu');
    const rollBtn = document.getElementById('roll');
    const betInput = document.getElementById('betAmount');
    const balanceEl = document.getElementById('balance');
    const statusEl = document.getElementById('status');
    const historyEl = document.getElementById('history');
    const resultArea = document.getElementById('resultArea');
    const sumEl = document.getElementById('sum');
    const payoutEl = document.getElementById('payout');
    const messageEl = document.getElementById('message');
    const jackpotEl = document.getElementById('jackpotAmount');
    const contribShow = document.getElementById('contribShow');
    const contribPct = document.getElementById('contribPct');

    // --- State (persist in localStorage) ---
    let balance = Number(localStorage.getItem('tx_balance')) || 200000;
    let jackpot = Number(localStorage.getItem('tx_jackpot')) || JACKPOT_BASE;
    let choice = localStorage.getItem('tx_choice') || 'TAI';
    let historyData = JSON.parse(localStorage.getItem('tx_history')) || [];
    if (historyData.length > 0) {
    historyData.forEach(item => addHistory(item));
}

    function saveState(){ localStorage.setItem('tx_balance', String(balance)); localStorage.setItem('tx_jackpot', String(jackpot)); localStorage.setItem('tx_choice', choice);localStorage.setItem('tx_history', JSON.stringify(historyData)); }

    function setChoice(c){ choice = c; btnTai.classList.toggle('active', c==='TAI'); btnXiu.classList.toggle('active', c==='XIU'); saveState(); }
    btnTai.addEventListener('click',()=>setChoice('TAI'));
    btnXiu.addEventListener('click',()=>setChoice('XIU'));

    function randDie(){ return Math.floor(Math.random()*6)+1; }
    function showShake(){ dieEls.forEach(e=>{ e.classList.add('shake'); setTimeout(()=>e.classList.remove('shake'),900); }) }

    async function rollDiceAnimation(){
      return new Promise((res)=>{
        const frames = 30; let i=0;
        const t = setInterval(()=>{
          dieEls.forEach((el)=>{ const r = Math.floor(Math.random()*6); el.textContent = diceChars[r]; });
          i++; if(i>=frames){ clearInterval(t); res(); }
        },60);
      });
    }

    function formatMoney(n){ return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".") + ' ‚Ç´'; }

    function addHistory(item){
      const div = document.createElement('div');
      div.className='h-item';
      div.innerHTML = `<div><strong>${item.choice}</strong> ‚Äî ${item.sum} (${item.dice.join('-')})</div><div style="text-align:right">${item.change>0?'+':''}${item.change} ‚Ç´</div>`;
      historyEl.prepend(div);
      while(historyEl.children.length>30) historyEl.removeChild(historyEl.lastChild);
    }

    function confettiBurst(){
      try{
        const c = document.getElementById('confetti'); const ctx = c.getContext('2d');
        c.style.display='block'; c.width = window.innerWidth; c.height = 200; ctx.clearRect(0,0,c.width,c.height);
        const pieces = []; for(let i=0;i<120;i++){ pieces.push({x:Math.random()*c.width,y:Math.random()*-200+50,vy:Math.random()*3+2,rx:Math.random()*6-3,vyrot:Math.random()*0.2, size:Math.random()*8+4, col: `hsl(${Math.random()*360},80%,60%)`}); }
        let t=0; const anim = setInterval(()=>{ ctx.clearRect(0,0,c.width,c.height); pieces.forEach(p=>{ p.y += p.vy; p.x += Math.sin(t/10+p.rx); ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(t/100 * p.vyrot); ctx.fillStyle=p.col; ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size); ctx.restore(); }); t++; if(t>180){ clearInterval(anim); c.style.display='none'; } },16);
      }catch(e){/* ignore canvas errors */}
    }

    async function play(){
      const bet = Number(betInput.value);
      if(!Number.isFinite(bet) || bet<=0){ alert('Nh·∫≠p s·ªë ti·ªÅn c∆∞·ª£c h·ª£p l·ªá (s·ªë d∆∞∆°ng).'); return; }
      if(bet>balance){ alert('B·∫°n kh√¥ng ƒë·ªß ti·ªÅn trong t√†i kho·∫£n.'); return; }

      rollBtn.disabled = true; resultArea.style.display='none'; messageEl.textContent='';

      showShake(); await rollDiceAnimation();

      const d1 = randDie(); const d2 = randDie(); const d3 = randDie();
      dieEls[0].textContent = diceChars[d1-1]; dieEls[1].textContent = diceChars[d2-1]; dieEls[2].textContent = diceChars[d3-1];

      const dice = [d1,d2,d3]; const sum = d1+d2+d3; sumEl.textContent = sum;

      // contribute to jackpot from this bet (demo rule: always add CONTRIB_PCT of bet, min 1)
      const contrib = Math.max(1, Math.floor(bet * CONTRIB_PCT));
      jackpot += contrib;

      // check results
      let change = 0; let outcome = '';

      if(d1===6 && d2===6 && d3===6){
        // TRIPLE SIX => Jackpot win for player
        const jackpotWon = jackpot; // award current jackpot
        change = jackpotWon + bet; // also give back bet as part of payout (demo)
        outcome = `N·ªî H≈®! B·∫°n tr√∫ng JACKPOT ${formatMoney(jackpotWon)} üéâ`;
        jackpot = JACKPOT_BASE; // reset
        confettiBurst();
      } else if(d1===d2 && d2===d3){
        // other tam hoa => house wins
        change = -bet;
        outcome = 'Tam Hoa ‚Äî Nh√† c√°i th·∫Øng (T√†i/X·ªâu ƒë·ªÅu thua)';
      } else {
        const isTai = sum >= 11 && sum <= 17;
        const isXiu = sum >= 4 && sum <= 10;
        const won = (choice==='TAI' && isTai) || (choice==='XIU' && isXiu);
        if(won){ change = bet; outcome = `B·∫°n th·∫Øng +${formatMoney(bet)}`; }
        else { change = -bet; outcome = `B·∫°n thua -${formatMoney(bet)}`; }
      }

      balance += change;
      if(balance<0) balance = 0;

      // persist
      saveState();

      balanceEl.textContent = balance;
      jackpotEl.textContent = formatMoney(jackpot);
      payoutEl.textContent = (change>=0?'+':'')+change+' ‚Ç´';
      messageEl.textContent = outcome;
      resultArea.style.display = 'flex';

      addHistory({choice, sum, dice, change});
      
      historyData.unshift({ choice, sum, dice, change });
      if (historyData.length > 50) historyData.pop(); // gi·ªØ t·ªëi ƒëa 50 v√°n g·∫ßn nh·∫•t
      localStorage.setItem('tx_history', JSON.stringify(historyData));
      rollBtn.disabled = false;
    }

    // init UI
    balanceEl.textContent = balance; jackpotEl.textContent = formatMoney(jackpot); contribShow.textContent = (CONTRIB_PCT*100)+'%'; contribPct.textContent = (CONTRIB_PCT*100)+'%';
    setChoice(choice);

    rollBtn.addEventListener('click', play);
    betInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') play(); });
    betInput.addEventListener('input', ()=>{ betInput.value = Math.max(1, Math.floor(Number(betInput.value)||0)); });

    // expose some debug helpers in console (optional)
    window._tx = {getState:()=>({balance,jackpot,choice}), resetJackpot:()=>{ jackpot = JACKPOT_BASE; saveState(); jackpotEl.textContent = formatMoney(jackpot); }};
    document.getElementById('backHome').addEventListener('click', () => {
    window.location.href = 'index.html'; });

  </script>
</body>
</html>
